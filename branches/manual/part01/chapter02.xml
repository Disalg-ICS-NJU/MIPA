<?xml version="1.0" encoding="UTF-8"?>
<chapter id="mipa.a-simple-example">
  <title>Getting Started</title>

  <para>In this chapter, we will show how to use the MIPA middleware infrastructure via a 'Hello World!' example.
  </para>
  
  <important>
	<para>MIPA is developed entirely in Java.</para>
	<para>All configuration files are written in XML.</para>
  </important>
  
  <para> To achieve context-awareness based on MIPA, the application simplely needs to take 4 steps:
  </para>
  
  <orderedlist>
	<listitem><para>Specify the context property it is concerned with </para></listitem>
	<listitem><para>Implement the callback interface</para></listitem>
	<listitem><para>Configure MIPA</para></listitem>
	<listitem><para>Launch MIPA and application</para></listitem>
  </orderedlist>
  
  <sect1 id="mipa.a-simple-example.predicate">
	<title>Specifying a Predicate</title>
  
	<para>We provide the <link
	  linkend="mipa.principle.predicate.definition">PDCC framework</link> for users to
	specify their RECA. Here is an example of a predicate delineating an
	application's RECA.
	</para>
  
	<programlisting>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE predicate SYSTEM "predicate.dtd"&gt;
&lt;predicate type="SCP"&gt;
  &lt;prefix value="def" /&gt;
  &lt;GSE value="conjunction"&gt;
    &lt;CGS value="conjunction"&gt;
      &lt;LP&gt;
	&lt;formula&gt;
	  &lt;atom operator="great-than" name="light" value="500" /&gt;
	&lt;/formula&gt;
      &lt;/LP&gt;
      &lt;LP&gt;
	&lt;formula&gt;
	  &lt;atom operator="not-contain" name="RFID" value="tag_00001" /&gt;
	&lt;/formula&gt;
      &lt;/LP&gt;
    &lt;/CGS&gt;
    &lt;global&gt;g&lt;/global&gt;
  &lt;/GSE&gt;
&lt;/predicate&gt;
</programlisting>
	<para>
	  In this example, the user is interested in the events of light and RFID. If
	  <code>light &gt; 500</code> and <code>RFID not-contain tag_00001</code>
	occur simultaneously, the application should be notified.
	</para>
  
	<para>In this chapter, we assume that the context which is specified in
	  the predicate is available for applications. If not, we will discuss this
	  case in <link linkend="mipa.usage.user.sensor">Chapter 3</link>.
	</para>
  </sect1>

  
  <sect1 id="mipa.a-simple-example.application">
	<title>Implementing the Callback Interface</title>
  
	<para>In order to be notified by MIPA, the application should implement the
	  callback interface.</para>
	
	<para>In this example, when the predicate is true, the application just
	  prints "Hello World!". The callback code is shown below.
	</para>
  
	<programlisting>
import net.sourceforge.mipa.application.AbstractApplication;

public class Application extends AbstractApplication {

      public void callback(String value) throws RemoteException {
            System.out.println("Hello World!");
      }
}
</programlisting>
  
  </sect1>

  <sect1 id="mipa.a-simple-example.system-config">
	<title>Configuring MIPA</title>
  
	<para>Before we run MIPA, the middleware should be configured. An example of
	a system configuration file is shown below. In this example, we should
		configure the IP address and port of a naming service which is a service of the
		<code>PD Side</code>.
	</para>
	
	<para>In this example, we choose <code>normal</code> mode of <code>check
	  mode</code>. The mode will be explained in <link
		linkend="mipa.usage.developer.checkMode">Check Mode</link> Section.
	</para>
  
	<programlisting>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE config SYSTEM "config.dtd"&gt;
&lt;config&gt;
	&lt;naming&gt;
		&lt;address&gt;127.0.0.1&lt;/address&gt;
		&lt;port&gt;1099&lt;/port&gt;
	&lt;/naming&gt;
	&lt;!-- normal or lattice --&gt;
	&lt;checkmode&gt;normal&lt;/checkmode&gt;
&lt;/config&gt;
</programlisting>
  </sect1>

  <sect1 id="mipa.a-simple-example.start-system">
	<title>Launching MIPA and application</title>
  
	<para>Before running the start-up scripts, we should write a little code for
	  creating a new application.
	</para>
	
		<programlisting>
Application app = new Application("predicate.xml");
app.start("config/config.xml");
</programlisting>
	
	<para>Now, let's launch the system.</para>
	
	<para>MIPA consists of two sides: <link linkend="mipa.principle.pd"><code>PD
		  Side</code></link> and <link linkend="mipa.principle.eca"><code>ECA
		  Side</code></link>. In this example, there are only one instance of the <code>PD
		Side</code> and one instance of the <code>ECA Side</code>.
	</para>
  
	<para>Start-up scripts are located in <code>${MIPA Home}/bin</code>, it supports
	both Linux and Windows operating systems. In this manual, we take Linux for
	example.
	</para>
  
	<para>The steps of starting <code>PD Side</code>: (Please replace <code>${MIPA
		Home}</code> as the actual value in your system)
	</para>
  
	<orderedlist>
	  <listitem><para><code>$cd ${MIPA Home}/bin/linux</code></para></listitem>
	  <listitem><para><code>$./MIPAInitialize</code></para></listitem>
	</orderedlist>
  
	<para>We can start up the <code>ECA Side</code> in the same computer of the
	  <code>PD Side</code> or in a new computer.
	</para>
  
	<para>The steps of launching an <code>ECA Side</code>:</para>
  
	<orderedlist>
	  <listitem><para><code>$cd ${MIPA Home}/bin/linux</code></para></listitem>
	  <listitem><para><code>$./ECAInitialize</code></para></listitem>
	</orderedlist>
  
	<para>In the last step, an application should be started. We supply an example
	whose start-up script is located in the same directory as others.
	</para>
  
	<para>The steps of launching the example:</para>
  
	<orderedlist>
	  <listitem><para><code>$cd ${MIPA Home}/bin/linux</code></para></listitem>
	  <listitem><para><code>$./application 1</code></para></listitem>
	</orderedlist>
  </sect1>
</chapter>